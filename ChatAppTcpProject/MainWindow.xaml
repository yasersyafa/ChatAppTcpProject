<Window x:Class="ChatAppTcpProject.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Modern TCP Chat Client" Height="600" Width="950"
        Loaded="Window_Loaded" Closing="Window_Closing"
        Background="{StaticResource BackgroundBrush}"
        Foreground="{StaticResource ForegroundBrush}"
        WindowStartupLocation="CenterScreen"
        MinHeight="500" MinWidth="800">
    
    <Window.Resources>
        <!-- Window Icon (optional) -->
        <Style TargetType="Window">
            <Setter Property="FontFamily" Value="Segoe UI"/>
        </Style>
    </Window.Resources>
    
    <Border CornerRadius="8" Background="{StaticResource BackgroundBrush}" Margin="8">
        <Border.Effect>
            <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="3" Opacity="0.2"/>
        </Border.Effect>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Header Section -->
            <Border Grid.Row="0" 
                    Background="{StaticResource HeaderGradientBrush}" 
                    CornerRadius="8,8,0,0" 
                    Padding="20,15">
                <Border.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="3" ShadowDepth="1" Opacity="0.1"/>
                </Border.Effect>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Connection Controls -->
                    <Grid Grid.Column="0" VerticalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" MinWidth="280"/>
                            <ColumnDefinition Width="Auto" MinWidth="180"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Server Connection Card -->
                        <Border Grid.Column="0" 
                                Background="{StaticResource CardBackgroundBrush}" 
                                CornerRadius="6" 
                                Padding="12,8" 
                                Margin="0,0,15,0"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*" MinWidth="140"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto" MinWidth="80"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="🌐" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Grid.Column="1" Text="Server:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,8,0" Foreground="{StaticResource ForegroundBrush}"/>
                                <TextBox Grid.Column="2" x:Name="ServerHostTextBox" Text="127.0.0.1" Margin="0,0,12,0" 
                                         MinWidth="120" MaxWidth="200" Height="32"
                                         VerticalContentAlignment="Center"
                                         Style="{StaticResource ModernTextBoxStyle}"/>
                                <TextBlock Grid.Column="3" Text="Port:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,8,0" Foreground="{StaticResource ForegroundBrush}"/>
                                <TextBox Grid.Column="4" x:Name="ServerPortTextBox" Text="8080" 
                                         MinWidth="70" MaxWidth="100" Height="32"
                                         VerticalContentAlignment="Center"
                                         Style="{StaticResource ModernTextBoxStyle}"/>
                            </Grid>
                        </Border>
                        
                        <!-- Nickname Card -->
                        <Border Grid.Column="1"
                                Background="{StaticResource CardBackgroundBrush}" 
                                CornerRadius="6" 
                                Padding="12,8" 
                                Margin="0,0,15,0"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*" MinWidth="100"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="👤" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Grid.Column="1" Text="Nickname:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,8,0" Foreground="{StaticResource ForegroundBrush}"/>
                                <TextBox Grid.Column="2" x:Name="NicknameTextBox" ToolTip="Enter your chat nickname"
                                         MinWidth="100" MaxWidth="150" Height="32"
                                         VerticalContentAlignment="Center"
                                         Style="{StaticResource ModernTextBoxStyle}"/>
                            </Grid>
                        </Border>
                        
                        <!-- Action Buttons -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,15,0">
                            <Button x:Name="ConnectButton" Width="90" Content="Connect" Click="ConnectButton_Click"
                                    Style="{StaticResource ModernButtonStyle}" Margin="0,0,8,0"/>
                            <Button x:Name="ReconnectButton" Width="90" Content="Reconnect" Click="ReconnectButton_Click" 
                                    IsEnabled="False" Style="{StaticResource ModernButtonStyle}"/>
                        </StackPanel>
                    </Grid>
                    
                    <!-- Status and Theme Controls -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <Border Background="{StaticResource CardBackgroundBrush}" 
                                CornerRadius="6" 
                                Padding="12,8" 
                                Margin="0,0,12,0"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1">
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Width="10" Height="10" Fill="{StaticResource StatusDisconnectedBrush}" 
                                         VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock x:Name="StatusTextBlock" VerticalAlignment="Center" 
                                           Foreground="{StaticResource StatusDisconnectedBrush}" Text="Disconnected"
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                        </Border>
                        
                        <Button x:Name="ThemeToggleButton" Width="50" Height="36" Content="🌙" Click="ThemeToggleButton_Click"
                                Style="{StaticResource ModernButtonStyle}" ToolTip="Toggle Dark/Light Theme"/>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Main Chat Area -->
            <Grid Grid.Row="1" Margin="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="250"/>
                </Grid.ColumnDefinitions>
                
                <!-- Chat Messages -->
                <Border Grid.Column="0" 
                        Background="{StaticResource ChatBackgroundBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" BlurRadius="4" ShadowDepth="1" Opacity="0.1"/>
                    </Border.Effect>
                    
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Chat Header -->
                        <Border Grid.Row="0" 
                                Background="{StaticResource HeaderGradientBrush}"
                                CornerRadius="8,8,0,0" 
                                Padding="15,10"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="0,0,0,1">
                            <TextBlock Text="💬 Chat Messages" 
                                       FontWeight="Bold" 
                                       FontSize="14"
                                       Foreground="{StaticResource ForegroundBrush}"/>
                        </Border>
                        
                        <!-- Chat List -->
                        <ListBox x:Name="ChatList" Grid.Row="1" 
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Padding="15"
                                 FontSize="13"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 ItemContainerStyle="{StaticResource ChatMessageItemStyle}"/>
                        
                        <!-- Typing Status Area -->
                        <Border x:Name="TypingStatusBorder" Grid.Row="2" 
                                Background="{StaticResource SecondaryBackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="0,1,0,0"
                                Padding="15,8"
                                Visibility="Collapsed"
                                Opacity="0">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <Trigger Property="Visibility" Value="Visible">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetProperty="Opacity"
                                                            From="0" To="1" Duration="0:0:0.3">
                                                            <DoubleAnimation.EasingFunction>
                                                                <PowerEase EasingMode="EaseOut"/>
                                                            </DoubleAnimation.EasingFunction>
                                                        </DoubleAnimation>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                            <Trigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetProperty="Opacity"
                                                            From="1" To="0" Duration="0:0:0.2"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.ExitActions>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="✏️" FontSize="12" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock x:Name="TypingStatusText" 
                                           FontSize="12" 
                                           FontStyle="Italic"
                                           Foreground="{StaticResource SystemMessageBrush}"
                                           VerticalAlignment="Center"
                                           Text="Someone is typing..."/>
                                <!-- Animated dots -->
                                <TextBlock x:Name="TypingDots" 
                                           FontSize="12" 
                                           Foreground="{StaticResource AccentBrush}"
                                           VerticalAlignment="Center"
                                           Margin="4,0,0,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value=""/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Visibility, ElementName=TypingStatusBorder}" Value="Visible">
                                                    <DataTrigger.EnterActions>
                                                        <BeginStoryboard>
                                                            <Storyboard RepeatBehavior="Forever">
                                                                <StringAnimationUsingKeyFrames Storyboard.TargetProperty="Text" Duration="0:0:1.2">
                                                                    <DiscreteStringKeyFrame Value="" KeyTime="0:0:0"/>
                                                                    <DiscreteStringKeyFrame Value="." KeyTime="0:0:0.3"/>
                                                                    <DiscreteStringKeyFrame Value=".." KeyTime="0:0:0.6"/>
                                                                    <DiscreteStringKeyFrame Value="..." KeyTime="0:0:0.9"/>
                                                                </StringAnimationUsingKeyFrames>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </DataTrigger.EnterActions>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
                
                <!-- Splitter -->
                <GridSplitter Grid.Column="1" Width="8" HorizontalAlignment="Stretch" 
                             VerticalAlignment="Stretch" Background="Transparent" ResizeBehavior="PreviousAndNext"/>
                
                <!-- Users List -->
                <Border Grid.Column="2" 
                        Background="{StaticResource UserListBackgroundBrush}"
                        BorderBrush="{StaticResource BorderBrush}" 
                        BorderThickness="1" 
                        CornerRadius="8">
                    <Border.Effect>
                        <DropShadowEffect Color="Black" BlurRadius="4" ShadowDepth="1" Opacity="0.1"/>
                    </Border.Effect>
                    
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Users Header -->
                        <Border Grid.Row="0" 
                                Background="{StaticResource HeaderGradientBrush}"
                                CornerRadius="8,8,0,0" 
                                Padding="15,10"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="0,0,0,1">
                            <TextBlock Text="👥 Online Users" 
                                       FontWeight="Bold" 
                                       FontSize="14"
                                       HorizontalAlignment="Center"
                                       Foreground="{StaticResource ForegroundBrush}"/>
                        </Border>
                        
                        <!-- Users List -->
                        <ListBox x:Name="UsersList" Grid.Row="1" 
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Padding="8"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ItemContainerStyle="{StaticResource UserListItemStyle}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Ellipse Width="10" Height="10" 
                                                 Fill="{StaticResource StatusConnectedBrush}" 
                                                 VerticalAlignment="Center" Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding}" 
                                                   VerticalAlignment="Center" 
                                                   FontSize="13" 
                                                   FontWeight="SemiBold"
                                                   Foreground="{StaticResource ForegroundBrush}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>
            </Grid>
            
            <!-- Message Input Area -->
            <Border Grid.Row="2" 
                    Background="{StaticResource HeaderGradientBrush}"
                    CornerRadius="0,0,8,8" 
                    Padding="20,15"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,1,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBox x:Name="MessageInput" Grid.Column="0" 
                             KeyDown="MessageInput_KeyDown" 
                             Style="{StaticResource ModernTextBoxStyle}" 
                             Height="38"
                             VerticalContentAlignment="Center"
                             Margin="0,0,15,0"
                             ToolTip="Type your message here. Press Enter to send. Use /w username message for private chat."/>
                    
                    <Button x:Name="SendButton" Grid.Column="1" 
                            Width="100" Height="36" Content="Send 📤" 
                            Click="SendButton_Click" 
                            IsEnabled="False" 
                            Style="{StaticResource ModernButtonStyle}"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
